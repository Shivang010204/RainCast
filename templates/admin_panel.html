<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RainCast | Admin Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            padding: 40px; 
            background-color: var(--bg); 
            height: auto; 
            overflow-y: auto; 
            font-family: 'Inter', sans-serif;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px; 
            margin-top: 20px;
        }
        
        .admin-table th {
            padding: 15px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-dim);
            text-align: left;
        }

        .admin-table td {
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-top: 1px solid var(--glass-border);
            border-bottom: 1px solid var(--glass-border);
            vertical-align: middle;
            color: white;
        }

        .admin-table tr td:first-child { border-left: 1px solid var(--glass-border); border-radius: 12px 0 0 12px; }
        .admin-table tr td:last-child { border-right: 1px solid var(--glass-border); border-radius: 0 12px 12px 0; }

        .admin-table tr:hover td {
            background: rgba(0, 243, 255, 0.05);
            border-color: var(--primary-glow);
        }

        .badge {
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
        }
        .badge-genuine { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid #10b981; }
        .badge-uncertain { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid #f59e0b; }
        .badge-flagged { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444; }

        .label-tiny {
            font-family: 'JetBrains Mono';
            color: var(--text-dim);
            font-size: 0.75rem;
        }

        .btn-purge {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            transition: 0.3s;
        }
        .btn-purge:hover {
            background: #ef4444;
            color: white;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
        }
    </style>
</head>
<body>

    <div class="glass-card" style="max-width: 1300px; margin: auto; padding: 30px;">
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div>
                <h2 style="margin: 0; color: var(--primary-glow); font-weight: 800; letter-spacing: -1px;">
                    <i class="fa-solid fa-gauge-high"></i> Operational Control
                </h2>
                <p class="label-tiny">Database Status: {{ records|length if records else 0 }} Active Logs</p>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="clearAllData()" class="mode-btn btn-purge">
                    <i class="fa-solid fa-trash-arrow-up"></i> Purge All Records
                </button>

                <a href="/" class="mode-btn" style="text-decoration:none;">
                    <i class="fa-solid fa-house"></i>
                </a>
                
                <a href="/admin_logout" class="mode-btn" style="color: #ef4444; text-decoration:none; border-color: rgba(239, 68, 68, 0.3);">
                    <i class="fa-solid fa-power-off"></i>
                </a>
            </div>
        </div>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            {% for message in messages %}
              <div class="glass-card" style="padding: 15px; margin-bottom: 20px; border-color: var(--primary-glow); color: var(--primary-glow); background: rgba(0, 243, 255, 0.05);">
                  <i class="fa-solid fa-circle-check"></i> {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% if records and records|length > 0 %}
        <div style="overflow-x: auto;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>City</th>
                        <th>AI Prediction</th>
                        <th>Evidence</th>
                        <th>Trust Metric</th>
                        <th>Terminal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in records %}
                    <tr>
                        <td class="label-tiny">{{ row[0] }}</td>
                        <td><b style="color: white; font-size: 0.9rem;">{{ row[1] }}</b></td>
                        <td>
                            <span class="{{ 'emerald-glow' if 'No Rain' in row[6] else 'amber-glow' }}" style="font-weight: 700;">
                                {{ row[6] }}
                            </span>
                        </td>
                        <td>
                            {% if row[12] and row[12] != "" %}
                            <img src="/static/uploads/{{ row[12] }}" 
                                 style="width: 45px; height: 30px; object-fit: cover; border-radius: 4px; border: 1px solid var(--glass-border); cursor: pointer;" 
                                 onclick="window.open(this.src)" 
                                 title="View Full Evidence">
                            {% else %}
                            <span style="opacity: 0.3; font-size: 0.65rem;">NULL_DATA</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if row[13] == 'Genuine' %}
                                <span class="badge badge-genuine">Verified</span>
                            {% elif row[13] == 'Pending' %}
                                <span class="badge badge-uncertain">Pending Review</span>
                            {% else %}
                                <span class="badge badge-flagged">Flagged</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="javascript:void(0);" onclick="confirmDelete('{{ loop.index0 }}')" 
                               style="color: #ef4444; opacity: 0.5; transition: 0.3s; font-size: 1.1rem;" 
                               onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.5">
                                <i class="fa-solid fa-circle-xmark"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 100px 20px; border: 1px dashed rgba(255,255,255,0.1); border-radius: 20px;">
            <i class="fa-solid fa-box-open" style="font-size: 3rem; color: var(--text-dim); margin-bottom: 20px; opacity: 0.2;"></i>
            <p style="color: var(--text-dim); font-size: 0.9rem;">Storage cluster empty. No records found in <code>history.csv</code>.</p>
        </div>
        {% endif %}
    </div>

    <script>
    function confirmDelete(idx) {
        if(confirm("TERMINAL ACTION: Permanently delete record sequence [" + idx + "]?")) {
            window.location.href = "/delete_record/" + idx;
        }
    }

    function clearAllData() {
        if (confirm("CRITICAL WARNING: This will purge the entire prediction history. Continue?")) {
            window.location.href = "/clear_all_data";
        }
    }
    </script>
</body>
</html>